@using BlazorHtmlEditor.Models
@using BlazorHtmlEditor.Services
@typeparam TModel
@inject IModelMetadataProvider MetadataProvider

<link href="_content/BlazorHtmlEditor/css/styles.css" rel="stylesheet" />

<div class="template-editor">
    <!-- Header s tabs -->
    <div class="editor-header">
        <h3>@Title</h3>
        <div class="editor-tabs">
            <button class="tab-button @(currentTab == EditorTab.Code ? "active" : "")"
                    @onclick="@(() => SwitchTab(EditorTab.Code))">
                Code
            </button>
            <button class="tab-button @(currentTab == EditorTab.Preview ? "active" : "")"
                    @onclick="@(() => SwitchTab(EditorTab.Preview))">
                Preview
            </button>
        </div>
        @if (ShowSaveButton)
        {
            <button class="btn btn-primary save-button" @onclick="OnSaveClicked">
                Save
            </button>
        }
    </div>

    <!-- Content Area -->
    <div class="editor-content">
        @if (currentTab == EditorTab.Code)
        {
            <!-- Code Tab: Monaco Editor + Model Properties Panel -->
            <div class="code-view">
                <div class="editor-main">
                    <RazorCodeEditor @ref="codeEditor"
                                     Code="@currentCode"
                                     OnCodeChanged="@OnCodeContentChanged" />
                </div>

                @if (ShowPropertiesPanel)
                {
                    <div class="properties-sidebar">
                        <ModelPropertiesPanel Properties="@modelProperties"
                                            OnPropertySelected="@OnPropertySelected" />
                    </div>
                }
            </div>
        }
        else if (currentTab == EditorTab.Preview)
        {
            <!-- Preview Tab: Live Rendered Template -->
            <div class="preview-view">
                <TemplatePreview TModel="TModel"
                                RazorTemplate="@currentCode"
                                DemoData="@demoData" />
            </div>
        }
    </div>
</div>

<style>
    .template-editor {
        display: flex;
        flex-direction: column;
        height: 100%;
        width: 100%;
    }

    .editor-header {
        display: flex;
        align-items: center;
        gap: 20px;
        padding: 12px 20px;
        background: #f5f5f5;
        border-bottom: 1px solid #ddd;
    }

    .editor-header h3 {
        margin: 0;
        font-size: 18px;
        color: #333;
    }

    .editor-tabs {
        display: flex;
        gap: 4px;
        flex: 1;
    }

    .tab-button {
        padding: 8px 20px;
        border: none;
        background: transparent;
        cursor: pointer;
        border-radius: 4px 4px 0 0;
        font-size: 14px;
        color: #666;
        transition: all 0.2s;
    }

    .tab-button:hover {
        background: #e0e0e0;
        color: #333;
    }

    .tab-button.active {
        background: white;
        color: #0066cc;
        font-weight: 600;
        border-bottom: 2px solid #0066cc;
    }

    .save-button {
        margin-left: auto;
    }

    .editor-content {
        flex: 1;
        overflow: hidden;
        background: white;
    }

    .code-view {
        display: flex;
        height: 100%;
        gap: 0;
    }

    .editor-main {
        flex: 1;
        min-width: 0;
    }

    .properties-sidebar {
        width: 300px;
        border-left: 1px solid #ddd;
        overflow-y: auto;
        background: #fafafa;
    }

    .preview-view {
        height: 100%;
        overflow: auto;
        padding: 20px;
        background: #fafafa;
    }
</style>
